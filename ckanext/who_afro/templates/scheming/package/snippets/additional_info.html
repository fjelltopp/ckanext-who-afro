{%- set exclude_fields = [
    'id',
    'title',
    'name',
    'notes',
    'tag_string',
    'owner_org',
    'private',
    'license_id',
    'disclaimer',
    'prohibited_uses'
    ] -%}

{%- set license_fields = [
    (_('Use'), 'license_text'),
    (_('Disclaimer'), 'disclaimer'),
    (_('Prohibited Uses'), 'prohibited_uses'),
    ] -%}

{%- set schema = h.scheming_get_dataset_schema(dataset_type) -%} 

<section class="additional-info">
  <h2 class="addition-info-title">{{ _('Metadata') }}</h2>

  {%- for group in schema.dataset_fields|groupby('display_group', default="Overview")|reverse -%}
    {%- set group_fields = [] -%}
    {%- for field in group.list -%}
      {%- if field.field_name not in exclude_fields
          and field.display_snippet is not none
          and pkg_dict.get(field.field_name) -%}
        {%- do group_fields.append(field) -%}
      {%- endif -%}
    {%- endfor -%}
    {%- if group_fields != [] -%}
      <h3 class="scheming-group-title">
        {{ _(group.grouper) }}
      </h3>
      <table class="table table-striped table-bordered table-condensed">
      {%- for field in group_fields -%}
          <tr>
            <th scope="row" class="dataset-label"  style="width:25%">{{
              h.scheming_language_text(field.label) }}</th>
            <td class="dataset-details"{%
              if field.display_property %} property="{{ field.display_property
              }}"{% endif %}>{%- snippet 'scheming/snippets/display_field.html',
              field=field, data=pkg_dict, schema=schema -%}</td>
          </tr>
      {%- endfor -%}
      </table>
    {%- endif -%}
  {% endfor %}
  {%- set license = h.get_license(pkg_dict.get('license_id', "no_license")) -%}
  {%- if license -%}
      <h3 class="scheming-group-title">
        {{ _("Access & Use") }}
      </h3>
      <table class="table table-striped table-bordered table-condensed">
          <tr>
            <th scope="row" class="dataset-label"  style="width:25%">{{_('Visibility')}}</th>
            <td class="dataset-details">
              {%- if pkg_dict.get('private', True) -%}
                {%- set org_title = pkg_dict.get('organization', {}).get('title', 'ORG NOT FOUND') -%}
                {{_("Private dataset - visible only to users who are members of \"{}\" or who have been specially designated as collaborators on this dataset.".format(org_title))}}
              {%- else -%}
                {{_("Publicly accessible")}}
              {%- endif -%}
            </td>
          </tr>
          <tr>
            <th scope="row" class="dataset-label"  style="width:25%">{{_('License')}}</th>
            <td class="dataset-details">
              {%- if license.get('url') -%}
                <a href="{{license['url']}}" target="_blank">{{license["title"]}} ({{license['id']}}) </a>
              {%- else -%}
                {{license["title"]}} ({{license["id"]}})
              {%- endif -%}
            </td>
          </tr>
          {%- for (license_field_label, license_field) in license_fields -%}
            {%- set license_field_content = pkg_dict.get(license_field, license.get(license_field, "")) -%}
            {%- if license_field_content -%}
            <tr>
              <th scope="row" class="dataset-label"  style="width:25%">{{license_field_label}}</th>
              <td class="dataset-details">
                {{ h.render_markdown(license_field_content) }}
              </td>
            </tr>
            {%- endif -%}
          {%- endfor -%}
      </table>
  {%- endif -%}
</section>
